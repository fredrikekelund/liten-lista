(function(){"use strict";ko.bindingHandlers.enterKey={init:function(e,t,n,r){var o=function(e,n){13===n.keyCode&&t().call(this)},a=function(){return{keyup:o}};ko.bindingHandlers.event.init(e,a,n,r)}},ko.bindingHandlers.randomPlaceholder={init:function(e,t){var n=t(),r=Math.floor(Math.random()*n.length),o="ex. "+n[r];e.setAttribute("placeholder",o)}};var e=function(e,t,n){this.title=ko.observable(e),this.completed=ko.observable(t),this.date=ko.observable(new Date),this.important=ko.computed(function(){return"!"===this.title()[this.title().length-1]},this),this.trimmedTitle=ko.computed(function(){return this.title().substr(0,[this.title().length-1])},this),this.important.subscribe(function(e){e===!1&&n.importantTodos.indexOf(this)>-1&&(document.activeElement.blur(),n.regularTodos.push(this),n.importantTodos.remove(this)),e===!0&&n.regularTodos.indexOf(this)>-1&&(document.activeElement.blur(),n.importantTodos.push(this),n.regularTodos.remove(this))},this),this.title.subscribe(function(e){""===e&&(document.activeElement.blur(),n.regularTodos.remove(this))},this),this.completed.subscribe(function(){this.important()===!0?n.stats.completedImportant(n.stats.completedImportant()+1):n.stats.completedRegular(n.stats.completedRegular()+1)},this)},t=function(t){this.parseTodos=function(t){for(var n=[],r=0;t.length>r;r++)n.push(new e(t[r].title,t[r].completed,this));return n},this.regularTodos=ko.observableArray(this.parseTodos(t.regularTodos||[])),this.importantTodos=ko.observableArray(this.parseTodos(t.importantTodos||[])),this.completedRegularTodos=ko.observableArray(this.parseTodos(t.completedRegularTodos||[])),this.completedImportantTodos=ko.observableArray(this.parseTodos(t.completedImportantTodos||[])),t.stats||(t.stats={}),this.stats={completedImportant:ko.observable(t.stats.completedImportant||0),completedRegular:ko.observable(t.stats.completedRegular||0)},this.stats.completed=ko.computed(function(){return this.stats.completedImportant()+this.stats.completedRegular()},this),this.inputValue=ko.observable(""),this.completedImportantVisible=ko.observable(!1),this.completedRegularVisible=ko.observable(!1),this.listName=ko.observable("Att göra"),this.showing=ko.observable("active"),this.showCompleted=function(){"active"===this.showing()&&(this.showing("completed"),this.hideCompletedImportant(),this.hideCompletedRegular())},this.showActive=function(){this.showing("active")},this.add=function(){var t=this.inputValue().trim(),n=function(){return"!"===t[t.length-1]};t&&(n()===!1?this.regularTodos.push(new e(t,!1,this)):n()===!0&&this.importantTodos.push(new e(t,!1,this)),this.inputValue(""))},this.hideCompletedImportant=function(){this.importantTodos.remove(function(e){return e.completed()===!0}),this.completedImportantVisible(!1)},this.hideCompletedRegular=function(){this.regularTodos.remove(function(e){return e.completed()===!0}),this.completedRegularVisible(!1)},this.clearCompletedImportant=function(){this.completedImportantTodos.removeAll()},this.clearCompletedRegular=function(){this.completedRegularTodos.removeAll()},this.complete=function(e){e.completed(!0),e.important()===!0?(r.completedImportantVisible(!0),r.completedImportantTodos.push(e)):(r.completedRegularVisible(!0),r.completedRegularTodos.push(e))},this.placeholderTexts=["sov en tupplur","städa hela toan","åka till ikea","dricka kaffe!","skriv dagboksinlägg"],Modernizr.localstorage&&ko.computed(function(){var e=ko.utils.arrayFilter(this.importantTodos(),function(e){return e.completed()===!1?e:void 0}),t=ko.utils.arrayFilter(this.regularTodos(),function(e){return e.completed()===!1?e:void 0}),n={importantTodos:e,regularTodos:t,completedImportantTodos:this.completedImportantTodos(),completedRegularTodos:this.completedRegularTodos(),stats:{completedImportant:this.stats.completedImportant(),completedRegular:this.stats.completedRegular()}};localStorage.setItem("todos",ko.toJSON(n))},this).extend({throttle:500})},n=Modernizr.localstorage?ko.utils.parseJson(localStorage.getItem("todos"))||{}:{},r=new t(n);ko.applyBindings(r)})();